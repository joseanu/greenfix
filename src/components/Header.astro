---
import { Image } from 'astro:assets';
import site from '../data/site.json';
import navigation from '../data/navigation.json';
import logoImg from '../assets/social/logo.png';

const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1); // remove the first "/"
---

<header class="siteHeader container">
  <div class="siteHeader__top row">
    <div class="siteHeader__logo">
      <a href="/">
        <Image src={logoImg} alt={site.title} />
      </a>
    </div>
    <div class="siteHeader__telefonos">
      <p class="siteHeader__telefono">Teléfonos</p>
      {site.owner.telefonos.map((tel) => (
        <p class="siteHeader__telefono">
          <a href={`tel:${tel}`}>{tel}</a>
        </p>
      ))}
    </div>
    <div class="siteHeader__social">
      <a href={site.owner.facebook} target="_blank" rel="noopener noreferrer">
        <svg width="2.4rem" height="2.4rem" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1579 128q35 0 60 25t25 60v1366q0 35-25 60t-60 25h-391v-595h199l30-232h-229v-148q0-56 23.5-84t91.5-28l122-1v-207q-63-9-178-9-136 0-217.5 80t-81.5 226v171h-200v232h200v595h-735q-35 0-60-25t-25-60v-1366q0-35 25-60t60-25h1366z" fill="currentColor"/></svg>
      </a>
    </div>
  </div>

  <div class="siteHeader__menu row">
    <button class="siteHeader__menuPrincipal__toggle" aria-label="Menu">≡</button>
    <nav class="siteHeader__menuPrincipal" role="navigation">
      {navigation.header.map((link) => (
        <div class="siteHeader__menuItem">
          <a 
            href={link.url} 
            class={`siteHeader__menuPrincipal__link ${pathname === link.url ? 'activo' : ''}`}
          >
            {link.title}
          </a>
          {link.submenu && (
            <div class="siteHeader__subMenu">
              {link.submenu.map((sublink) => (
                <a 
                  href={sublink.url} 
                  class={`siteHeader__subMenu__link ${pathname === sublink.url ? 'activo' : ''}`}
                >
                  {sublink.title}
                </a>
              ))}
            </div>
          )}
        </div>
      ))}
    </nav>
  </div>
</header>

<script>
  // Manejo básico del toggle del menú (manteniendo el espíritu del original)
  const toggle = document.querySelector('.siteHeader__menuPrincipal__toggle');
  const menu = document.querySelector('.siteHeader__menuPrincipal');
  
  toggle?.addEventListener('click', () => {
    menu?.classList.toggle('is-open');
  });
</script>
