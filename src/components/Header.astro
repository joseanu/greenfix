---
import { Image } from 'astro:assets';
import site from '../data/site.json';
import navigation from '../data/navigation.json';
import logoImg from '../assets/social/logo.png';

const pathname = new URL(Astro.request.url).pathname;
---

<header class="siteHeader" id="mainHeader">
  <div class="header-container">
    <div class="siteHeader__logo">
      <a href="/">
        <Image src={logoImg} alt={site.title} />
      </a>
    </div>

    <nav class="siteHeader__nav" id="siteNav" role="navigation">
      {navigation.header.map((link) => (
        <div class="siteHeader__menuItem">
          <a 
            href={link.url} 
            class={`siteHeader__menuLink ${pathname === link.url ? 'activo' : ''}`}
          >
            {link.title}
          </a>
          {link.submenu && (
            <div class="siteHeader__subMenu">
              {link.submenu.map((sublink) => (
                <a href={sublink.url}>{sublink.title}</a>
              ))}
            </div>
          )}
        </div>
      ))}
      <div class="header-cta">
        <a href="/contacto" class="button button-primary">Cotizar</a>
      </div>
    </nav>

    <button class="menu-toggle" type="button" aria-label="Abrir Menú" aria-expanded="false" aria-controls="siteNav">☰</button>
  </div>
</header>

<script>
  // Sticky header on scroll
  const header = document.getElementById('mainHeader');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      header?.classList.add('is-sticky');
    } else {
      header?.classList.remove('is-sticky');
    }
  });

  // Mobile menu toggle
  const toggle = document.querySelector('.menu-toggle');
  const nav = document.getElementById('siteNav');
  const closeMenu = () => {
    header?.classList.remove('menu-open');
    toggle?.setAttribute('aria-expanded', 'false');
  };

  toggle?.addEventListener('click', () => {
    const isOpen = header?.classList.toggle('menu-open');
    toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
  });

  nav?.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', closeMenu);
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth > 768) {
      closeMenu();
    }
  });

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      closeMenu();
    }
  });
</script>
