---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import site from '../data/site.json';

const title = "Contacto - Green Fix Limpieza";
const description = "Solicite una cotizaci贸n personalizada para servicios de limpieza y mantenimiento en Guadalajara.";
---

<Layout title={title} description={description} bodyClass="siteContacto">
  <Header />
  
  <main class="container section-padding">
    <div class="services-intro">
      <h1>Hablemos de su <span>Proyecto</span></h1>
      <p>Estamos listos para ofrecerle una soluci贸n a la medida de sus necesidades de limpieza y mantenimiento.</p>
    </div>

    <div class="contact-layout">
      <aside class="contact-info">
        <h2>Informaci贸n de Contacto</h2>
        
        <div class="info-item">
          <div class="icon"></div>
          <div>
            <h4>Tel茅fonos</h4>
            {site.owner.telefonos.map(tel => (
              <p><a href={`tel:${tel}`}>{tel}</a></p>
            ))}
          </div>
        </div>

        <div class="info-item">
          <div class="icon">锔</div>
          <div>
            <h4>Email</h4>
            <p><a href={`mailto:${site.owner.email}`}>{site.owner.email}</a></p>
          </div>
        </div>

        <div class="info-item">
          <div class="icon"></div>
          <div>
            <h4>Horario de Atenci贸n</h4>
            <p>Lunes a Viernes: 9:00 AM - 6:00 PM</p>
            <p>S谩bados: 9:00 AM - 1:00 PM</p>
          </div>
        </div>

        <div class="info-item">
          <div class="icon"></div>
          <div>
            <h4>Ubicaci贸n</h4>
            <p>Guadalajara, Jalisco, M茅xico</p>
          </div>
        </div>
      </aside>

      <div class="contact-form-card">
        <form method="post" id="formContacto">
          <fieldset>
            <label for="nombre">Nombre Completo</label>
            <input type="text" name="nombre" id="nombre" placeholder="Ej. Juan P茅rez" required>
            
            <label for="correo">Correo Electr贸nico</label>
            <input type="email" name="correo" id="correo" placeholder="juan@empresa.com" required>
            
            <label for="empresa">Empresa / Instituci贸n</label>
            <input type="text" name="empresa" id="empresa" placeholder="Nombre de su negocio">
            
            <label for="mensaje">驴En qu茅 podemos ayudarle?</label>
            <textarea name="mensaje" id="mensaje" placeholder="Describa brevemente el servicio que requiere" required></textarea>
            
            <input type="text" name="_gotcha" style="display:none" />
            
            <button id="frm-enviar" type="submit" class="button button-primary" style="width: 100%;">Enviar Solicitud de Cotizaci贸n</button>
          </fieldset>
        </form>
      </div>
    </div>
  </main>
</Layout>

<script>
  const form = document.getElementById('formContacto') as HTMLFormElement;
  const btn = document.getElementById('frm-enviar') as HTMLButtonElement;

  if (form) {
    form.addEventListener('submit', async (evt) => {
      evt.preventDefault();
      const formData = new FormData(form);
      const statusMessage = document.createElement('div');
      statusMessage.className = 'status';
      
      const oldStatus = form.parentElement?.querySelector('.status');
      if (oldStatus) oldStatus.remove();
      
      form.insertBefore(statusMessage, form.firstChild);
      btn.disabled = true;
      statusMessage.innerHTML = 'Enviando...';

      try {
        const response = await fetch('/api/contacto', {
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' }
        });

        if (response.ok) {
          statusMessage.innerHTML = 'Muchas gracias. Hemos recibido su solicitud y le contactaremos a la brevedad.';
          statusMessage.className = 'status success';
          form.reset();
        } else {
          statusMessage.innerHTML = 'Tuvimos un problema. Por favor intente llamando por tel茅fono.';
          statusMessage.className = 'status error';
          btn.disabled = false;
        }
      } catch (error) {
        statusMessage.innerHTML = 'Error de conexi贸n.';
        statusMessage.className = 'status error';
        btn.disabled = false;
      }
    });
  }
</script>

<style lang="scss">
  @use "../styles/parcial/variables" as *;
  .section-padding { padding: 12rem 0 8rem; }
  h1 span { color: $brand-color; }
  .status {
    padding: 2rem;
    margin-bottom: 3rem;
    border-radius: 6px;
    font-weight: 600;
    &.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    &.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  }
</style>
